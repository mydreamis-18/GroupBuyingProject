-- [ 22.10.11 ]

-- 16:43
프로젝트 주제는 공동 구매의 쇼핑몰 페이지

-- git 계정도 새로 생성했음!

-- 지금은 익숙하지만 언젠간 까먹을 지 모를 필요한 git 명령어
git init
git config --global user.name "mydreamis-18"
git config --global user.email "email"
git config --global --list
git branch -M main
git remote add origin https://github.com/mydreamis-18/GroupBuyingProject.git
git add .
git commit -m "first commit"
git push -u origin main

-- 자 여기서 1st 문제 발생...
remote: Permission to mydreamis-18/GroupBuyingProject.git denied to mydreamis-a.
fatal: unable to access 'https://github.com/mydreamis-18/GroupBuyingProject.git/': The requested URL returned error: 403

-- 해결 방법
제어판 - 사용자 계정 - windows 자격 증명 관리 - github 계정 제거 후 git push 재시도

-- 17:05
오늘 목표
상품 등록 페이지 완성
전체적인 환경 구축 및 상품 데이터에 대한 시퀄라이즈 완성

-- front 리액트 폴더 생성 명령어
npx create-react-app front

-- back 명령어
npm init -y
npm --save-dev nodemon
npm i express sequelize mysql2 redux react-redux redux-thunk react-router-dom axios cors styled-components

-- .gitignore 파일
node_modules/

-- 17:17
그 다음 할 일
백엔드 서버 연결
프론트와 백엔드 연결

-- 17:34
백엔드 서버 연결 작업 순서
1. app.js 파일 생성 => express().listen(PORT)
2. .env 파일 생성 => DATABASE_PASSWORD = ""
3. config 파일 생성 => MySQL 연결을 위한 config 객체 생성
4. model 폴더 생성 => db 객체 생성 => sequelize 키 값에 MySQL 연결 객체 생성
5. app.js 파일 => MySQL 연동 => sequelize.sync({ force: false })

-- 18:05
프론트와 백엔드 연결 중 2nd 문제 발생
Warning: Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it.

-- 해결
문법 => { AddProduct } => <AddProduct />

-- 18:16
스타일드 컴포넌트 설정 중 3rd 문제 발생
Uncaught Error: Cannot find module 'styled-components'

-- 해결
여러 가지의 npm 모듈을 동시에 설치할 때 글자 수 제한이 있나 봄... 재설치 진행

-- 18:20
스타일드 컴포넌트 설정 중 4th 문제 발생
Warning: The tag <flex_temp> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.

-- 해결
문법 => flex_temp => Flex_temp

5th 문제 발생
Imported JSX component Flex_temp must be in PascalCase or SCREAMING_SNAKE_CASE

-- 해결
문법 => Flex_temp => FlexTemp

-- 18:29
상품 등록 페이지
프론트 1차 뼈대 완료

이제 axios 사용해서 백엔드로 인풋 데이터 넘기기
백엔드 시퀄라이즈 모델 생성하기

리덕스는 나중에 하자...

-- 18:39
프론트 파일명 변경 후 parsing error 6th 문제 발생

-- 해결
리액트 서버 종료 후 재실행

-- 18:43
프론트 input 값에 useRef() 함수 사용하기

여러 개의 useRef() 관리하기
=> 초기 값을 배열로 선언
=> <input ref={(el) => (product.current[0] = el)} />

-- 18:58
axios 사용하기
axios 사용하려면 데이터의 동기적 처리를 위해 미들웨어 환경을 먼저 구축해놔야 하는 군...

-- question
action은 모아서 어디로 가는가?

-- 19:18
프론트 저장소 생성 및 props 전달 중 7th 문제 발생
Uncaught Error: Cannot find module 'react-redux'

-- 해결
아무래도 모듈이 누락 설치된 듯... 재설치 진행

-- 프론트 redux 저장소 작업 순서
1. store 파일 생성 => 저장소 생성 => createStore(reducer, applyMiddleware(thunk))
2. reducer 파일 생성 => reducer() 함수 선언
3. middleware 폴더의 action 파일 생성 => axios 사용하는 함수 선언
4. index.js 파일 => Provider 컴포넌트에 props로 저장소 전달 => <Provider store={store}>

-- 19:31
이제 axios를 사용해보자!

프론트 쪽 연결 중...

-- question
저장소의 값을 만지지 않더라도 반드시 useDispatch() 함수를 거쳐야 하는 건가?

-- 19:55
백엔드에 data가 도달하는 지 확인해보려는데 8th 문제 발생
Uncaught (in promise) TypeError: Converting circular structure to JSON
    --> starting at object with constructor 'HTMLInputElement'

운동 가야 하므로 일단 여기까지...
집에 가서 꼭 해결하자꾸나!

-- [ 22.10.12 ]

-- 01:52
노트북 깃 설정에서 9th 문제 발생
fatal: not a git repository (or any of the parent directories): .git

-- 해결
git init을 안 해서...

-- 07:55
지하철 안 작업 중 10th 문제 발생
ConnectionError [SequelizeConnectionError]: Unknown database 'gb_project'

-- 해결
MySQL 스키마 생성을 안 해서...

-- 20:15
컨디션이 안 좋군...

-- 8th 문제 해결
HTML 태그가 담겨있어서 그런 것인가, 아니면 그로 인한 순환 참조 같은 문제가 발생한 것인가...

useRef() 함수 객체의 그 자체를 백엔드로 보내면 에러가 발생하여
input의 onChange() 함수를 통해 useRef() 함수 객체의 value 키 값을 배열로 만든 다음 원하는 값을 담아 객체로 전달

그런데 여기서 ref란...?
onChange() 함수 없이도 실시간으로 값이 바뀌는 것인가?

-- 구글링
useRef() 를 사용하여 Ref 객체를 만들고, 이 객체를 우리가 선택하고 싶은 DOM 에 ref 값으로 설정해주어야 합니다.
그러면, Ref 객체의 .current 값은 우리가 원하는 DOM 을 가르키게 됩니다.

-- 20:48
input type="number" step="1000" min="0"

-- 09:38
작업 일지 작성 완료
작업 시작

-- 09:52
숫자 input 예외 처리 중 11th 문제 발생
Warning: Invalid value for prop `value` on <input> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM.

-- 다른 방식으로 해결
type="number" 설정을 하고
onChange() 함수를 사용하니
아무리 if (e.target.value) 조건을 걸어도
문자 입력 시에 onChange() 함수가 실행되지 않아
입력한 문자가 계속 해서 남아 있는 상태

onChange() 함수 대신
onInput() 함수로 바꾸니
onIntput() 함수가 정상적으로 실행되어
if 조건으로 문자 입력 시
e.target.value 값을 초기화시킴

두 함수에 미세한 차이가 있는 듯 한데
그건 다음에 알아보도록 하자.

-- 10:31
금액 input 태그에 천 단위 쉼표를 넣고 싶었으나
tpye="number" 설정 때문인지 쉼표가 삽입되지 않음
아무래도 둘 중 하나를 선택해야 될 듯...

그래도 나중을 위해 방법 기록해두기!
e.target.value = Number(e.target.value).toLocaleString();

-- 10:49
ref 객체에 배열 대신 객체로 담기

-- 11:15
input 태그의 isNull 유효성 체크 완료
이제 날짜의 유효성 검사를....

npm install react-datepicker --save

datepicker 참고 링크
https://reactdatepicker.com/#example-select-time

-- 11:35
index.js 파일에서 datepicket style 조정

.react-datepicker-wrapper {
  width: auto !important;
}

-- 13:05
판매 시작 시각과 종료 시각의 유효성 체크
날짜는 완료

시간은 패스...

datepicker에서
showTimeSelect 설정을 사용하려면 minTime, maxTime 설정 필요

showTimeInput 설정은 minTime, maxTime 설정해도 안 되는 듯...

minTime 및 maxTime 설정을 위해
setMinutes, setHours 함수를 사용하려면 import 필요

import setHours from "date-fns/setHours";
import setMinutes from "date-fns/setMinutes";

-- 14:13
현재 이후의 시간을 선택하도록 날짜 및 시간에 대한 유효성을 체크하는 함수 구현 완료

이제 데이터가 잘 넘어가는 지 한 번 보자.
이름, 이미지, 설명만 넘어가는 군...

숫자 input은 되었다 안 되었다 하는 건지 예의주시 필요

선택한 날짜 데이터를 사용하기 위해
자식 컴포넌트가 아닌 부모 컴포넌트에서 state 값 사용

-- 14:59
12th 문제 발생
그런데 백엔드의 날짜 데이터가 axiois before 값과 다른 값이군... '2022-10-12T05:35:18.107Z'

-- 15:24
product 모델 생성 중 13th 문제 발생
Product.init is not a function

-- 해결
모델 class의 js 파일 => 문법 => module.exports = 모델명
모델 폴더의 index.js 파일 => 문법 => module.exports = { sequelize, 모델명 }

-- 15:38
시퀄라이즈 테이블에 데이터를 추가할 때
객체의 키 값과 컬럼명이 전부 동일할 경우
객체명만 전달하여 데이터를 추가할 수 있음!

그런데 상품 등록 버튼을 1번 클릭했음에도 불구하고
같은 데이터가 여러 번 추가되는 문제 발생
거기다 랜덤임...
예의주시 필요...

-- 16:13
12th 문제 고민
프론트의 날짜 데이터의 타입은 object
백엔드로 넘어온 날짜 데이터의 타입은 string

데이터를 어떻게 사용할 것이냐에 따라
데이터를 어떻게 저장할 지 정해야 하는데...

상품 상세 페이지에서 남은 시간을 표시하는 데 사용해야 해...

-- 17:06
타임스탬프 date.getTime()으로 저장하겠어...

-- 17:39
상품 이미지 미리 보기 구현 중 14th 문제 발생
Uncaught TypeError: Failed to execute 'createObjectURL' on 'URL': Overload resolution failed.

-- 다른 방식으로 해결
URL.createObjectURL(product.value.img) => 삼항 연산자 => URL.createObjectURL(img)
아마도 사진 선택 전에는 value 객체에 img 키 값이 없어서 그런 듯...

그리고 삼항 연산자를 사용하더라도 ref 객체의 값이 바뀌는 거라 리렌더링되지 않아서 선택한 사진이 적용되지 않는 듯...
별개의 useState 값을 사용하여 리렌더링을 유도함으로써 해결

-- 18:53
이제 문제는 MySQL에 이미지 파일 저장하는 것...

multer 모듈을 사용하려면 axios가 아닌 form 사용해야만 하는 건가?
그런데 form으로 사후처리가 가능하던가?

-- 19:57
흑 정말이지 욕 하기 싫은데 욕 하고 싶다...
formData...

-- 20:30
모든 input 태그에 값이 있으나 ref 객체에 데이터가 저장되지 않는 15th 문제 발생
POST http://localhost:8000/addProduct net::ERR_CONNECTION_REFUSED
Uncaught (in promise) AxiosError {message: 'Network Error',
WHERE parameter "name" has invalid "undefined" value

ref 객체의 문제인가?
리렌더링에도 유지되는 범위는 current 키 값 한정인가?

-- 21:22
겁나 허탈하게...
숫자 타입 input 태그의 onChange() 함수를 지우니
저절로 문자 입력이 되지 않는다...

-- 21:37
ref 객체는 모두 current 키 값만 사용하도록 변경 완료

ref 객체 그대로를 백엔드로 보낼 경우 발생했던 8th 문제에 대하여
current 키 값에 태그 대신 value 값으로 덮어씌움으로써 해결함!

이제 다음 작업은...
등록된 상품 정보를 이용해 상품 상세 페이지 구현